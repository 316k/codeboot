
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>codePlay</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Styles -->
    <link href="include/bootstrap/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
    <link href="include/bootstrap/css/bootstrap-responsive.css" rel="stylesheet">
    <link rel="stylesheet" href="include/codemirror3/lib/codemirror.css">
    <link rel="stylesheet" href="include/codemirror3/theme/eclipse.css">
    <link href="codeplay.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <script src="include/compat.js"></script>
    <script src="include/modernizr-custom.js"></script>
    <script type="text/javascript">
        window.MISSING   = 0;
        window.EMULATED  = 1;
        window.SUPPORTED = 2;

        window.features = [
            {
              name: "File reader",
              url:  "http://caniuse.com/filereader",
              status: Modernizr.filereader ? SUPPORTED : MISSING
            },
            {
              name: "JSON",
              url:  "http://caniuse.com/json",
              status: Modernizr.json ? SUPPORTED : EMULATED
            }
        ];

        Modernizr.load([
            {
                test : Modernizr.json,
                nope : ['include/polyfills/json2.js']
            }
        ]);
    </script>
  </head>

  <body onunload="cp.saveSession();">
    <!-- Navbar -->
    <div id="navbar" class="navbar navbar-fixed-top navbar-inverse">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="#">codePlay v0.6<span id="devModeTitle"></span></a>

          <button id="btn-help" class="btn btn-primary pull-right" onclick="cp_tutorial();">Help</button>
        </div>
      </div>
    </div>

    <!-- Content -->
    <div class="container">    
      <!-- Editor -->
      <!--
      <div class="row">
        <ul class="nav nav-tabs">
          <li class="active"><a href="#">Untitled.js</a></li>        
        </ul>
        <div class="tab-content">
          <div class="tab-pane active" id="home">...</div>
        </div>
      </div>
      -->
      
      <!-- Console -->
      <div class="row">
        <div class="btn-toolbar pull-right">
          <div class="btn-group">
            <button id="clear-button" title="Clear REPL" class="btn" onclick="cp.clearAll();"><i class="icon-trash"></i></button>
          </div>
          <div class="btn-group">
            <button id="step-button" title="Step" class="btn" onclick="cp.step();"><i class="icon-play"></i><img id="step-mode-icon" src="icons/exp_pause.png"><img id="single-step-icon" style="display:none;" src="icons/exp_1.png"></button>
            <button id="play-button" title="Execute" class="btn" onclick="cp.play();"><i class="icon-play"></i><img src="icons/exp_inf.png"></button>
            <div class="btn-group">
              <button id="animate-button" title="Animate" class="btn" onclick="cp.animate(500);"><i class="icon-play"></i></button>
	          <button id="animate-dropdown" class="btn dropdown-toggle hidden" data-toggle="dropdown">
			    <span class="caret"></span>
			  </button>
	          <ul class="dropdown-menu">
	            <li><a href="#" onclick="cp.animate(2000);">Animate slowly</a></li>
	            <li><a href="#" onclick="cp.animate(500);">Animate</a></li>
	            <li><a href="#" onclick="cp.animate(125);">Animate quickly</a></li>
	          </ul>
            </div>
            <button id="pause-button" title="Pause" class="btn disabled" onclick="cp.animate(0);"><i class="icon-pause"></i></button>
            <button id="cancel-button" title="Stop" class="btn disabled" onclick="cp.cancel();"><i class="icon-stop"></i></button>
          </div>          
        </div>
          
        <ul class="nav nav-tabs">          
          <li class="active"><a href="#">REPL</a></li>
        </ul>
        <pre id="repl" class="tab-content"><div id="transcript"></div><hr id="transcript-sep"/><div id="console"></div></pre>
      </div>

      <div class="row">
        <pre id="step-value" class="exec-point-code" style="display:none;"></pre>
      </div>

    </div>

    <!-- Imports (importing at the end makes the page load faster) -->
    <script src="include/jquery.js"></script>
    <script src="include/bootstrap/js/bootstrap.js"></script>
    <script src="include/codemirror3/lib/codemirror.js"></script>
    <script src="include/codemirror3/mode/javascript/javascript.js"></script>
    <script src="include/codemirror3/lib/util/matchbrackets.js"></script>
    <script src="include/cm-autoclose.js"></script>

    <script src="include/polyfills/BlobBuilder.js"></script>
    <script src="include/polyfills/FileSaver.js"></script>

    <script src="include/js2js/system.js"></script>
    <script src="include/js2js/num.js"></script>
    <script src="include/js2js/scanner.js"></script>
    <script src="include/js2js/parser.js"></script>
    <script src="include/js2js/pp.js"></script>
    <script src="include/js2js/ast-passes.js"></script>
    <script src="include/js2js/eval.js"></script>

    <script type="text/javascript">
        window.cp = {
            builtins: {},

            // state
            currentConsoleLine: undefined,

            // Elements
            alerts: undefined,
            repl: undefined,
            console: undefined,
        };
                        
        function onAnimateClickAndHold() {
	        $("#animate-dropdown").parent().addClass("open");
        }
        
        cp.setDevMode = function (devMode) {
            cp.devMode = devMode;
            if (cp.devMode) {
                $("#navbar").removeClass("navbar-inverse");
                $("#devModeTitle").text(" (dev mode)");
            } else {
                $("#navbar").addClass("navbar-inverse");
                $("#devModeTitle").text("");
            }
        };    

        $(document).ready(function() {
            Mousetrap.bind('ctrl+\\', function () {
                cp.setDevMode(!cp.devMode);
            });
            window.onbeforeunload = function () {
                if (!cp.devMode) {
                    return "You codePlay session will be lost."
                } else {
                    return undefined;
                }
            };
            // checkBrowserFeatures();
            
            // Install click-and-hold handler on animate button
            var clickAndHoldTimeout = 0;
			$('#animate-button').bind('mousedown', function() {
			    clickAndHoldTimeout = setTimeout(onAnimateClickAndHold, 1000);
			}).bind('mouseup mouseleave', function() {
			    clearTimeout(clickAndHoldTimeout);
			});

            cp.alerts = document.getElementById("alerts");
            cp.repl   = createREPL(document.getElementById("repl"));
            cp.transcript = createTranscript(document.getElementById("transcript"));
            cp.console = document.getElementById("console");
            cp.devMode = false;

            document.getElementById("transcript").style.display='none';
            
            cp.loadSession();

            $("#repl").click(focusREPL);

            cp.handle_query();
        });

        function checkBrowserFeatures() {
            var MISSING = 0, EMULATED = 1, SUPPORTED = 2;
            var status = SUPPORTED;

            for (var i = 0; i < window.features.length; i++) {
                var feature = window.features[i];
                var status_label;
                switch (feature.status) {
                  case MISSING:
                    status_label = "missing";
                    break;
                  case EMULATED:
                    status_label = "emulated";
                    break;
                  default:
                    status_label = "supported";
                    break;
                }

                $("#browserIssues ul").append($("<li/>").append($('<a/>').attr('href', feature.url).attr("target", "new").text(feature.name + " " + status_label)));
                status = Math.min(status, feature.status);
            }

            if (status === SUPPORTED) {
                $("#browserStatus").addClass("badge-success");
                $("#browserStatusMsg").text("All features supported");
                $("#browserStatusIcon").addClass("icon-ok");
            } else if (status === EMULATED) {
                $("#browserStatus").addClass("badge-warning");
                $("#browserStatusMsg").text("Some features are emulated");
                $("#browserStatusIcon").addClass("icon-warning-sign");
            } else {
                $("#browserStatus").addClass("badge-important");
                $("#browserStatusMsg").text("Some features are missing");
                $("#browserStatusIcon").addClass("icon-exclamation-sign");
            }
        }

        function focusREPL() {
            cp.repl.focus();
        }
    </script>
    <script src="include/actions.js"></script>
    <script src="include/editors.js"></script>
    <script src="include/builtins.js"></script>
    <script src="include/storage.js"></script>
    <script src="include/mousetrap.min.js"></script>
    <script src="include/tutorial.js"></script>
    <script>cp.query(null);</script>
  </body>
</html>
