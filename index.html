
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>codePlay</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Styles -->
    <link href="include/jquery-ui/css/custom-theme/jquery-ui-1.8.16.custom.css" rel="stylesheet">
    <link href="include/bootstrap/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
    <link href="include/bootstrap/css/bootstrap-responsive.css" rel="stylesheet">
    <link rel="stylesheet" href="include/codemirror3/lib/codemirror.css">
    <link rel="stylesheet" href="include/codemirror3/theme/eclipse.css">
    <link href="codeplay.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <script src="include/compat.js"></script>
    <script src="include/modernizr-custom.js"></script>
    <script type="text/javascript">
        window.MISSING   = 0;
        window.EMULATED  = 1;
        window.SUPPORTED = 2;

        window.features = [
            {
              name: "File reader",
              url:  "http://caniuse.com/filereader",
              status: Modernizr.filereader ? SUPPORTED : MISSING
            },
            {
              name: "JSON",
              url:  "http://caniuse.com/json",
              status: Modernizr.json ? SUPPORTED : EMULATED
            }
        ];

        Modernizr.load([
            {
                test : Modernizr.json,
                nope : ['include/polyfills/json2.js']
            }
        ]);
    </script>
  </head>

  <body onunload="cp.saveSession();">
    <!-- Navbar -->
    <div id="navbar" class="navbar navbar-fixed-top navbar-inverse">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="#">codePlay v0.9.2<span id="devModeTitle"></span></a>

          <ul class="nav">
            <li><a href="#" onclick="cp_tutorial();">Help</a></li>
            <li><a href="#" role="button" data-toggle="modal" data-target="#about-box">About</a></li>
          </ul>

          <div class="btn-toolbar pull-right">
              <div class="btn-group" data-toggle="buttons-radio">
                  <button id="anim-slow-button" type="button" class="btn" onclick="setStepDelay(2000);"><img src="icons/snail.png" alt="slow" title="Slow animation"></img></button>
                  <button id="anim-norm-button" type="button" class="btn" onclick="setStepDelay(500);"><img src="icons/turtle.png" alt="normal" title="Normal animation"></img></button>
                  <button id="anim-fast-button" type="button" class="btn" onclick="setStepDelay(125);"><img src="icons/hare.png" alt="fast" title="Fast animation"></img></button>
              </div>

              <div class="btn-group">
                  <button id="new-file-button" title="New file" class="btn" onclick="cp.newFile();"><i class="icon-plus"></i><i class="icon-file"></i></button>
                  <button class="btn dropdown-toggle" data-toggle="dropdown">
                      <span class="caret"></span>
                  </button>
                  <ul id="file-list" class="dropdown-menu dropdown-align-right">
                      <!-- This menu will be populated dynamically -->
                  </ul>
              </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Content -->
    <div id="contents" class="container">
      <!-- Editor -->
      <!--
      <div class="row">
        <ul class="nav nav-tabs">
          <li class="active"><a href="#">Untitled.js</a></li>
        </ul>
        <div class="tab-content">
          <div class="tab-pane active" id="home">...</div>
        </div>
      </div>
      -->

      <!-- Console -->
      <div id="floating-console">
        <div id="console-row" class="row">
          <div id="repl-controls" class="btn-toolbar pull-right" data-cp-exec="controller">
            <div class="btn-group">
              <button id="step-button" title="Step" class="btn exec-btn-step" onclick="cp.animate(0);"><i class="icon-play"></i><i id="step-mode-icon" class="icon-exp-pause"></i></button>
              <button id="play-button" title="Execute" class="btn" onclick="cp.play();"><i class="icon-play"></i><i class="icon-exp-infinity"></i></button>
              <button id="animate-button" title="Animate" class="btn" onclick="cp.animate(cp.stepDelay);"><i class="icon-play"></i></button>
              <button id="pause-button" title="Pause" class="btn exec-btn-pause disabled" onclick="cp.animate(0);"><i class="icon-pause"></i></button>
              <button id="cancel-button" title="Stop" class="btn exec-btn-cancel disabled" onclick="cp.cancel();"><i class="icon-stop"></i></button>
            </div>
          </div>

          <ul class="nav nav-tabs">
            <li class="active"><a href="#">Console</a></li>
            <li><div class="btn-toolbar">
                  <div class="btn-group">
                     <button id="clear-button" title="Clear console" class="btn" onclick="cp.clearAll();"><i class="icon-trash"></i></button>
                  </div>
                </div>
             </li>
          </ul>
          <pre id="repl" class="tab-content"><div id="transcript"></div><hr id="transcript-sep"/><div id="console"></div></pre>
        </div>

        <div id="step-value-row" class="row">
          <pre id="step-value" class="step-value" style="display:none;"></pre>
        </div>
      </div>

      <div id="editors"></div>

      <div id="about-box" class="modal hide fade">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h3>About codePlay</h3>
        </div>
        <div class="modal-body">
          <p>codePlay is developped by Marc Feeley and Bruno Dufour using the following components:</p>
          <ul>
            <li><a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a></li>
            <li><a href="http://jquery.com/" target="_blank">jQuery</a></li>
            <li><a href="http://jqueryui.com/" target="_blank">jQuery UI</a></li>
            <li><a href="http://codemirror.net/" target="_blank">CodeMirror</a></li>
            <li><a href="http://modernizr.com/" target="_blank">Modernizr</a></li>
            <li><a href="http://craig.is/killing/mice" target="_blank">Mousetrap</a></li>
            <li><a href="http://ekamanganese.deviantart.com/art/Snail-Vector-94976805" target="_blank">Snail icon</a> by ekamanganese</li>
            <li><a href="http://thenounproject.com/noun/rabbit/#icon-No5354" target="_blank">Rabbit icon</a> by Samuel Fine from The Noun Project</li>
            <li><a href="http://gentleface.com/">Gentleface icons</a></li>
          </ul>
          <p>The code is freely <a href="https://github.com/feeley/codeplay" target="_blank">available on Github</a>. Feel free
             to <a href="https://github.com/feeley/codeplay/issues/new" target="_blank">report issues</a> or contribute.</p>
        </div>
        <div class="modal-footer">
          <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
        </div>
      </div>
    </div>

    <div id="codeplay-footer">
    </div>

    <!-- Imports (importing at the end makes the page load faster) -->
    <script src="include/jquery.js"></script>
    <script src="include/jquery-ui/js/jquery-ui-1.8.16.custom.min.js"></script>
    <script src="include/bootstrap/js/bootstrap.js"></script>
    <script src="include/codemirror3/lib/codemirror.js"></script>
    <script src="include/codemirror3/mode/javascript/javascript.js"></script>
    <script src="include/codemirror3/lib/util/matchbrackets.js"></script>
    <script src="include/codemirror3/lib/util/formatting.js"></script>
    <script src="include/cm-autoclose.js"></script>

    <script src="include/polyfills/BlobBuilder.js"></script>
    <script src="include/polyfills/FileSaver.js"></script>

    <script src="include/jseval/system.js"></script>
    <script src="include/jseval/num.js"></script>
    <script src="include/jseval/scanner.js"></script>
    <script src="include/jseval/parser.js"></script>
    <script src="include/jseval/pp.js"></script>
    <script src="include/jseval/ast-passes.js"></script>
    <script src="include/jseval/eval.js"></script>

    <script type="text/javascript">
        window.cp = {
            builtins: {},

            // state
            currentConsoleLine: undefined,
            saveInProgress: false,

            // Elements
            alerts: undefined,
            repl: undefined,
            console: undefined,
        };

        function setStepDelay(delay) {
            cp.stepDelay = delay;
            program_state.step_delay = delay;
        }

        cp.setDevMode = function (devMode) {
            cp.devMode = devMode;
            if (cp.devMode) {
                $("#navbar").removeClass("navbar-inverse");
                $("#devModeTitle").text(" (dev mode)");
            } else {
                $("#navbar").addClass("navbar-inverse");
                $("#devModeTitle").text("");
            }
        };

        function cp_internal_getBounds($element) {
            var offset = $element.offset();
            var w = $element.width();
            var h = $element.height();
            return {
                left: offset.left,
                top: offset.top,
                width: w,
                clientWidth: w,
                height: h,
                clientHeight: h
            };
        }

        $(document).ready(function() {
            Mousetrap.bind('ctrl+\\', function () {
                cp.setDevMode(!cp.devMode);
            });
            Mousetrap.bind('ctrl+shift+c', function () {
                cp.closeAll();
            });
            window.onbeforeunload = function () {
                if (cp.saveInProgress) {
                    cp.saveInProgress = false;
                    return undefined;
                }
                if (!cp.devMode) {
                    return "You codePlay session will be lost."
                } else {
                    return undefined;
                }
            };
            // checkBrowserFeatures();

            $("#anim-norm-button").click();

            cp.alerts = document.getElementById("alerts");
            cp.repl   = createREPL(document.getElementById("repl"));
            cp.transcript = new CPTranscript(createTranscript(document.getElementById("transcript")));
            cp.console = document.getElementById("console");
            cp.devMode = false;

            $("#editors").on("scroll", function () {
                var $firstEditor = $("#editors").children().first();
                $("#console-row").toggleClass("shadow", $firstEditor.size() > 0 && $firstEditor.position().top < 0);

                if (!program_state.step_popover) return;

                var marker = program_state.step_mark;
                var range = marker.find();
                if (range) {
                    var editorsViewport = cp_internal_getBounds($("#editors"));
                    var pos = marker.cm.charCoords(range.from, "page");
                    if (!within(pos, editorsViewport)) {
                        program_state.step_popover.popover('hide');
                    } else {
                        var popover = program_state.step_popover.data('popover');
                        var $element = $(popover.tip());
                        var arrow_height = 10 + 5; // Extra padding for safety
                        if (pos.bottom + $element.height() + arrow_height >= editorsViewport.top + editorsViewport.clientHeight) {
                            popover.options.placement = "top";
                        } else {
                            popover.options.placement = "bottom";
                        }
                        program_state.step_popover.popover('show');
                    }
                }
                // cp_internal_updatePopupPos();
            });



            document.getElementById("transcript").style.display='none';
            $(window).resize(cp_internal_resizeEditors);
            cp_internal_resizeEditors();

            cp.initFS();

            cp.loadSession();

            $("#repl").click(focusREPL);

            cp.handle_query();

            // Stop navigation to '#'
            $('body')
                .on('click.codeplay', '[href="#"]', function (e) { e.preventDefault(); });
        });

        function cp_internal_resizeEditors() {
            var $console = $("#console-row");
            var consoleOffset = $console.offset();
            $("#editors")
                .css("left", consoleOffset.left)
                .css("right", consoleOffset.left)
                .css("top", consoleOffset.top + $console.height());
        }

        function checkBrowserFeatures() {
            var MISSING = 0, EMULATED = 1, SUPPORTED = 2;
            var status = SUPPORTED;

            for (var i = 0; i < window.features.length; i++) {
                var feature = window.features[i];
                var status_label;
                switch (feature.status) {
                  case MISSING:
                    status_label = "missing";
                    break;
                  case EMULATED:
                    status_label = "emulated";
                    break;
                  default:
                    status_label = "supported";
                    break;
                }

                $("#browserIssues ul").append($("<li/>").append($('<a/>').attr('href', feature.url).attr("target", "new").text(feature.name + " " + status_label)));
                status = Math.min(status, feature.status);
            }

            if (status === SUPPORTED) {
                $("#browserStatus").addClass("badge-success");
                $("#browserStatusMsg").text("All features supported");
                $("#browserStatusIcon").addClass("icon-ok");
            } else if (status === EMULATED) {
                $("#browserStatus").addClass("badge-warning");
                $("#browserStatusMsg").text("Some features are emulated");
                $("#browserStatusIcon").addClass("icon-warning-sign");
            } else {
                $("#browserStatus").addClass("badge-important");
                $("#browserStatusMsg").text("Some features are missing");
                $("#browserStatusIcon").addClass("icon-exclamation-sign");
            }
        }

        function focusREPL() {
            cp.repl.focus();
        }

        function saveAs(content, filename) {
            $("#form-download-content").val(content);
            $("#form-download-filename").val(filename);
            cp.saveInProgress = true;
            $("#form-download").submit();
        }

        function cp_about() {

        }
    </script>
    <script src="include/actions.js"></script>
    <script src="include/editors.js"></script>
    <script src="include/builtins.js"></script>
    <script src="include/fs.js"></script>
    <script src="include/storage.js"></script>
    <script src="include/mousetrap.min.js"></script>
    <script src="include/tutorial.js"></script>
    <script src="include/output.js"></script>
    <script src="include/jquery.clippy.min.js"></script>
    <script>cp.query(null);</script>

	<form id="form-download" class="hide" action="download.php" method="post">
	  <textarea id="form-download-content" name="content" style="width: 0; height: 0;"></textarea>
	  <textarea id="form-download-filename" name="filename" style="width: 0; height: 0;"></textarea>
	</form>

	<div id="urlModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="urlModalLabel" aria-hidden="true">
	  <div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
		<h3 id="urlModalLabel">Share link <span id="urlModal-clippy"></span></h3>
	  </div>
	  <div class="modal-body">
		<pre id="urlModal-body"></pre>
	  </div>
	  <div class="modal-footer">
		<button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
	  </div>
	</div>
  </body>
</html>
